name: Convert

on:
  schedule:
    - cron: "0 7 * * *"
  workflow_dispatch:

permissions:
  contents: write

concurrency:
  group: convert-${{ github.ref }}
  cancel-in-progress: false

jobs:
  convert:
    name: Convert Lists
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v5

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: Convert
        run: |
          if [ ! -f convert.sh ]; then
            echo "Error: convert.sh not found"
            exit 1
          fi
          chmod +x convert.sh
          bash convert.sh
        env:
          repository: ${{ github.repository }}

      - name: Release
        uses: stefanzweifel/git-auto-commit-action@v7
        with:
          branch: release
          skip_checkout: true
          skip_dirty_check: true
          push_options: '--force'
          file_pattern: 'release/*'
          commit_message: "chore(release): update converted lists"
          commit_user_name: "github-actions[bot]"
          commit_user_email: "41898282+github-actions[bot]@users.noreply.github.com"

      - name: Delete old workflow runs
        uses: Mattraks/delete-workflow-runs@v2.1.0
        with:
          token: ${{ github.token }}
          repository: ${{ github.repository }}
          retain_days: 0
          keep_minimum_runs: 1
